---
title: "Surprise study pilot 19"
author: "Marjan Biria"
date: "2024-03-11"
output: 
    pdf_document:
    toc: true
    toc_depth: 2
    toc_float: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(root.dir = "aim_lab_1", echo = TRUE)
```

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(lme4)
library(parameters)
library(broom.mixed)
library(purrr)
library(conflicted)
library(stringr)
library(readxl)
```


\newpage
# Study description

This study is the same as pilot 16, (pilots 17 and 18 had the chocking element), we only show 4 judges, show histograms only early on, and ask them how they think they will perform/did perform/ how the judge thought they performed. We have also removed the certainty rating from this version.

The Gorilla experiment is the following: https://app.gorilla.sc/admin/project/128379
The task is the following: https://app.gorilla.sc/admin/task/788287/editor



```{r echo=FALSE, warning=FALSE, message=FALSE}
df19_raw <- read.csv("/Users/marjan/Desktop/aim_lab_1/De_identified_data/surprise_pilot_19/SUP_PRF_p19_vid_bigPE_nar2_new_qns_hist_early_4jud_v5/SUP_PRF_p19_vid_bigPE_nar2_new_qns_hist_early_4jud_v5_task_main.csv")
df19_spin <- read.csv("/Users/marjan/Desktop/aim_lab_1/De_identified_data/surprise_pilot_19/SUP_PRF_p19_vid_bigPE_nar2_new_qns_hist_early_4jud_v5/SUP_PRF_p19_vid_bigPE_nar2_new_qns_hist_early_4jud_v5_mini_spin.csv")
df19_cesd <- read.csv("/Users/marjan/Desktop/aim_lab_1/De_identified_data/surprise_pilot_19/SUP_PRF_p19_vid_bigPE_nar2_new_qns_hist_early_4jud_v5/SUP_PRF_p19_vid_bigPE_nar2_new_qns_hist_early_4jud_v5_ces_d.csv")

```


```{r echo=FALSE, warning=FALSE, message=FALSE}
# extract CES-D scores
CESD_data_clean <- df19_cesd[, c(32, 34, 36, 38, 40, 42, 44, 46,48,50,
                                 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 71 )]
# Identify non-ID variable columns
non_id_cols <- setdiff(names(CESD_data_clean), "Random_ID")

# Convert non-ID variables to numeric
CESD_data_clean[, non_id_cols] <- lapply(CESD_data_clean[, non_id_cols], as.numeric)

#change numbers to match CES-D scoring system
excluded_columns <-  c("Random_ID", "Multiple.Choice.Grid.object.3.4...I.felt.I.was.just.as.good.as.other.people..Quantised",
                       "Multiple.Choice.Grid.object.3.8...I.felt.hopeful.about.the.future..Quantised",
                       "Multiple.Choice.Grid.object.3.12...I.was.happy..Quantised",
                       "Multiple.Choice.Grid.object.3.16...I.enjoyed.life..Quantised")
                  

CESD_data_clean<- CESD_data_clean %>%
  mutate(across(-excluded_columns , ~ case_when(
    . == 1 ~ 0,
    . == 2 ~ 1,
    . == 3 ~ 2,
    . == 4 ~ 3,
    TRUE ~ .
  )))


other_columns <- c("Multiple.Choice.Grid.object.3.4...I.felt.I.was.just.as.good.as.other.people..Quantised",
                   "Multiple.Choice.Grid.object.3.8...I.felt.hopeful.about.the.future..Quantised",
                   "Multiple.Choice.Grid.object.3.12...I.was.happy..Quantised",
                   "Multiple.Choice.Grid.object.3.16...I.enjoyed.life..Quantised")
CESD_data_clean<- CESD_data_clean %>%
  mutate(across(other_columns , ~ case_when(
    . == 1 ~ 3,
    . == 2 ~ 2,
    . == 3 ~ 1,
    . == 4 ~ 0,
    TRUE ~ .
  )))

#scoring----
CESD_scores <-  numeric(length(CESD_data_clean$Random_ID))
CESD_scores <- 0
Questions <- c(1:20)

for (i in 1:nrow(CESD_data_clean)) {
  CESD_score <- sum(CESD_data_clean[i, Questions])
  CESD_scores[i] <- CESD_score
}

CESD_data_clean$CESD_score <-  CESD_scores

CESD_data_clean$Depression_Threshold<- 0
CESD_data_clean$Depression_status <- "Not_Depressed"

#Assign "1" if they meet Depression threshold 
for (i in 1:nrow(CESD_data_clean)) {
  if (CESD_data_clean$CESD_score[i] >= 16) {
    CESD_data_clean$Depression_Threshold[i] <- 1
    CESD_data_clean$Depression_status[i] <- "Depressed"
  }
}
```


```{r echo=FALSE, warning=FALSE, message=FALSE}
# We have now different names for different screens:
# Prediction (how well do you think you performed?)
# prediction_2 (how well do you think you performed?)
# feedback (This is how well X thought you performed)
# First 4 trials are with the histograms and are called "Trials_Histogram" in Display column instead of "Trials"
# The trial numbers start from 1 again after the histograms so we need to concatenate them all.
# Let's rename them to "Trials" to extract them together with the rest of the trials

df19_raw$Trial.Number[df19_raw$Display == "Trials "] <- df19_raw$Trial.Number[df19_raw$Display == "Trials "] + 4

df19_raw <- df19_raw %>%
  mutate(Screen = if_else(Screen == "Prediction", "Prediction ", Screen))


df19_raw <- df19_raw %>%
  mutate(Display = if_else(Display == "Trials_Histogram", "Trials ", Display))

df19_spin <- df19_spin %>%
  rename(
   "Q1" =  "Rating.Scale.object.2.Fear.of.embarrassment.causes.me.to.avoid.doing.things.or.speaking.to.people.",
   "Q2" =  "Rating.Scale.object.2.I.avoid.activities.in.which.I.am.the.center.of.attention.",
   "Q3" = "Rating.Scale.object.2.Being.embarrassed.or.looking.stupid.are.among.my.worst.fears."
  )

df19_spin <- df19_spin %>%
  rowwise() %>%
  mutate(mini_SPIN_total = sum(c(Q1, Q2, Q3), na.rm = TRUE)) %>%
  ungroup()


# create a new df19 that only keeps the columns we need
df19 <- df19_raw[, c("Trial.Number", "Display", "Screen", "Response.Type", "Response", 
                     "Reaction.Time", "Spreadsheet..Histogram", "Spreadsheet..Feedback", "Random_ID")]

df19 <- df19 %>%
  mutate(Response = as.numeric(as.character(Response))) %>%
  dplyr::filter(!is.na(Response))

df19$Screen <- ifelse(df19$Trial.Number == 1 & (df19$Display == "Mood " | df19$Display == "Anxiety "), "BL_1",
                      ifelse(df19$Trial.Number == 2 & (df19$Display == "Mood " | df19$Display == "Anxiety "), "BL_2", 
                             df19$Screen))

df19$m_hist <- ifelse(df19$Spreadsheet..Histogram == "h2.png", 29,
                             ifelse(df19$Spreadsheet..Histogram == "h3.png", 37,
                                                  ifelse(df19$Spreadsheet..Histogram == "h6.png", 63,
                                                         ifelse(df19$Spreadsheet..Histogram == "h7.png", 71, NA))))  


# get rid of the rows we don't need: practice runs, continue button presses etc. and only keep Trials, Anxiety and Mood that include all variables we are interested in:
df19 <- df19 %>%
  dplyr::filter(
    (Display == "Trials ") |
      (Display == "Exit") |
      (Display == "Anxiety " & !Trial.Number %in% c(1, 2)) |
      (Display == "Mood " & !Trial.Number %in% c(1, 2))
  )

# # setting Mood and Anxiety trial numbers to match the trials starting from 1 (since we removed the baseline ones above)
df19$Trial.Number <- ifelse(df19$Display == 'Mood ' | df19$Display == 'Anxiety ', df19$Trial.Number - 2, df19$Trial.Number)
df19$Display <- ifelse(df19$Display == 'Mood ' | df19$Display == 'Anxiety ', "Trials", df19$Display)

# renaming the feedback column to fdbk
names(df19)[names(df19) == 'Spreadsheet..Feedback'] <- 'fdbk'

# Now let's create columns for PE (fdbk-hist) and Subj_PE (fdbk_Prediction)

df19$SubjPE <- ifelse(df19$Screen == "Prediction ", df19$fdbk - df19$Response, NA)
df19$PE <- ifelse(df19$Screen == "Prediction ", df19$fdbk - df19$m_hist, NA)
# to keep just one repetition of feedback and mean histogram per trial per subject 
# and replace the rest with NA so that when we want to convert to long format we won't have duplicates
df19$fdbk <- ifelse(df19$Screen == "Prediction ", df19$fdbk, NA)
df19$m_hist <- ifelse(df19$Screen == "Prediction ", df19$m_hist, NA)
df19$stress_level <- ifelse(df19$Screen == "Screen 12", df19$Response, NA)

long_df19 <- df19 %>%
  dplyr::select(Random_ID, Trial.Number, fdbk, m_hist, PE, SubjPE, stress_level) %>%
  pivot_longer(cols = c(fdbk, m_hist, PE, SubjPE, stress_level),
               names_to = "Screen",
               values_to = "Response")

# This will keep only the rows where 'Response' is not NA
long_df19 <- long_df19[!is.na(long_df19$Response), ]

# Selecting relevant columns from the original df19
df19 <- df19 %>%
  dplyr::select(-c(fdbk, m_hist, PE, SubjPE, stress_level))

# Binding the rows together
df19 <- bind_rows(df19, long_df19)

df19$Response <- as.numeric(df19$Response)

# looking at the relationship between PE and SubjPE
df19_PE <- subset(df19, Screen == "PE")
names(df19_PE)[names(df19_PE) == "Screen"] <- "Screen_PE"
names(df19_PE)[names(df19_PE) == "Response"] <- "Response_PE"

df19_SubjPE <- subset(df19, Screen == "SubjPE")
names(df19_SubjPE)[names(df19_SubjPE) == "Screen"] <- "Screen_SubjPE"
names(df19_SubjPE)[names(df19_SubjPE) == "Response"] <- "Response_SubjPE"

df19_fdbk <- subset(df19, Screen == "fdbk")
names(df19_fdbk)[names(df19_fdbk) == "Screen"] <- "Screen_fdbk"
names(df19_fdbk)[names(df19_fdbk) == "Response"] <- "Response_fdbk"

df19_hist <- subset(df19, Screen == "m_hist")
names(df19_hist)[names(df19_hist) == "Screen"] <- "Screen_m_hist"
names(df19_hist)[names(df19_hist) == "Response"] <- "Response_m_hist"

df19_stress_level <- subset(df19, Screen == "Screen 12")
names(df19_stress_level)[names(df19_stress_level) == "Screen"] <- "Screen_stress_level"
names(df19_stress_level)[names(df19_stress_level) == "Response"] <- "Response_stress_level"

df19_predic <- subset(df19, Screen == "Prediction ")
names(df19_predic)[names(df19_predic) == "Screen"] <- "Screen_pred"
names(df19_predic)[names(df19_predic) == "Response"] <- "Response_pred"

df19_predic2 <- subset(df19, Screen == "prediction_2")
names(df19_predic2)[names(df19_predic2) == "Screen"] <- "Screen_pred2"
names(df19_predic2)[names(df19_predic2) == "Response"] <- "Response_pred2"

# df19_cert <- subset(df19, Screen == "Certainty rating ")
# names(df19_cert)[names(df19_cert) == "Screen"] <- "Screen_certainty"
# names(df19_cert)[names(df19_cert) == "Response"] <- "Response_certainty"

list_of_dfs_19 <- list(df19_PE, df19_fdbk, df19_hist, df19_predic, df19_predic2, df19_SubjPE)

# Using reduce with inner_join
merged_df19 <- reduce(list_of_dfs_19, inner_join, by = c("Random_ID", "Trial.Number"))

df19_Anxious <- subset(df19, Screen == "Anxious")
names(df19_Anxious)[names(df19_Anxious) == "Screen"] <- "Screen_Ax"
names(df19_Anxious)[names(df19_Anxious) == "Response"] <- "Response_Ax"

df19_Happy <- subset(df19, Screen == "Happy")
# df19_fdbk <- subset(df19, Screen == "Prediction")
names(df19_Happy)[names(df19_Happy) == "Screen"] <- "Screen_H"
names(df19_Happy)[names(df19_Happy) == "Response"] <- "Response_H"

final_df19 <- merged_df19 %>%
  inner_join(df19_Anxious, by = c("Random_ID", "Trial.Number")) %>%
  inner_join(df19_Happy, by = c("Random_ID", "Trial.Number"))


# subset only the columns we are interested in
final_df19 <- final_df19[c("Trial.Number", "Random_ID", "Response_H", "Response_Ax", "Response_fdbk", "Response_SubjPE", "Response_PE", "Response_m_hist", "Response_pred", "Response_pred2")]

final_df19 <- final_df19 %>%
  left_join(df19_spin %>% dplyr::select(Random_ID, mini_SPIN_total), by = "Random_ID")

final_df19 <- final_df19 %>%
  left_join(df19_stress_level %>% dplyr::select(Random_ID, Response_stress_level), by = "Random_ID")

final_df19 <- final_df19 %>%
  left_join(CESD_data_clean %>% dplyr::select(Random_ID, CESD_score, Depression_Threshold, Depression_status), by = "Random_ID")

final_df19$Social_Anxiety <- ifelse(final_df19$mini_SPIN_total >= 6, "high", "low")

final_df19$SubjPE_2 <- final_df19$Response_pred2 - final_df19$Response_pred
final_df19$SubjPE_3 <- final_df19$Response_fdbk - final_df19$Response_pred2


# List of people who clearly stated they believed the judges were not real
specified_ids <- c("SUPPRF04400", "SUPPRF43481", "SUPPRF74749", "SUPPRF80118", 
                   "SUPPRF76403", "SUPPRF08502", "SUPPRF25195", "SUPPRF82413", 
                   "SUPPRF19812", "SUPPRF19869", "SUPPRF84532", "SUPPRF76734", 
                   "SUPPRF02691")

# Creating a new column based on condition to divide people into "No" or "Yes/maybe/NA" category about believability 
final_df19$believability <- ifelse(final_df19$Random_ID %in% specified_ids, "No", "Yes/maybe/NA")



write.csv(final_df19, "pilot_19_variables.csv", row.names = FALSE)


final_df19 %>%
  group_by(Random_ID) %>%
  summarise(Trial.Number = n())

write.csv(final_df19, "final_df19_with_stresslevels.csv", row.names = FALSE)

```



\newpage 
# Relationship between prediction and mean histogram

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_m_hist, Response_pred, method = "spearman", use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2)))

# # calculate the average correlation across all individuals and print it
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mean_hist and prediction:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = Response_m_hist, y = Response_pred, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) +
  # labs(color="Legend") +
  theme_minimal() +
  xlab("prediction") +
  ylab("mean_histogram") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),
        axis.text.y = element_text(size = 5.5),
        strip.text.x = element_text(face = "bold"),
        strip.text.y = element_text(face = "bold"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank())


ggplot(final_df19, aes(x = Response_pred, y = Response_m_hist)) +
  # geom_point(aes(color="Data Points")) +
  geom_smooth(method = "lm", color = "blue", fill = "blue", alpha = 0.3) +  # Wider error shades with alpha for transparency
  labs(color = "Legend") +
  # facet_wrap(~ Random_ID, scales = "free") +
  theme_minimal() +
  theme(
    text = element_text(size = 16),  # Increase overall font size
    plot.title = element_text(size = 20),  # Increase title size
    panel.grid = element_blank()  # Remove grid lines
  ) +
  xlab("Prediction") + 
  ylab("Histogram mean") +
 scale_y_continuous(breaks = c(30, 40, 50, 60, 70), limits = c(30, 70)) +
  ggtitle("Relationship between Expectation and Histogram Mean")


correlations_mean_df3 <- final_df19 %>%
  group_by(Random_ID) %>%
  summarize(correlation = cor(Response_pred, Response_m_hist, use = "complete.obs"),
            .groups = 'drop')  # This line is used to avoid a grouped df as output

average_correlation <- mean(correlations_mean_df3$correlation, na.rm = TRUE)
average_correlation

# long format to be able to have histogram and prediction stacked:
df19_long <- final_df19 %>%
  pivot_longer(
    cols = c(Response_m_hist, Response_pred),  # The columns you want to stack
    names_to = "variable",  # Name of the new column that will hold the names of the stacked columns
    values_to = "value"  # Name of the new column that will hold the values of the stacked columns
  )


ggplot(df19_long, aes(x = Trial.Number, y = value, color = variable, group = variable)) +
  geom_line() +
  theme_minimal() +
  labs(title = "Expectation across time",
       x = "Trial Number",
       y = "Expectation",
       color = "") +
  facet_wrap(~ Random_ID, ncol = 5)
  
```

\newpage 
# Relationship between Anxiety and SubjPE

SubjPE = feedback - prediction (before performance)

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations_Ax <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_Ax, Response_SubjPE, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_Ax$correlation, na.rm = TRUE)
message_to_print_Ax <- paste("average correlation between anxiety and SubjPE:", average_correlation)

print(message_to_print_Ax)

ggplot(final_df19, aes(x = Response_SubjPE, y = Response_Ax, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE: feedback - prediction") + 
  ylab("Anxiety") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_Ax, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
ylim(c(0, 100)) +
scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
xlim(c(-100, 100)) +
scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
```

\newpage 
# Relationship between Anxiety and SubjPE_2 
Here SubjPE_2 was calculated by looking at the difference between the ratings on questions before and after the performance: "how well you performed?" minus "how well do you think you will performe?".


```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations_Ax <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_Ax, SubjPE_2, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_Ax$correlation, na.rm = TRUE)
message_to_print_Ax <- paste("average correlation between anxiety and SubjPE_2:", average_correlation)

print(message_to_print_Ax)

ggplot(final_df19, aes(x = SubjPE_2, y = Response_Ax, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE: prediction2 - prediction1") + 
  ylab("Anxiety") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_Ax, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
ylim(c(0, 100)) +
scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
xlim(c(-100, 100)) +
scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
```

\newpage 
# Relationship between predictions before and after performance 

We will see in the following pages that the relationship between SubjPE and SubjPE3 with mood and anxiety is very similar. If the predictions before and after performance would be very similar (highly correlated), it would make sense as SubjPE is calcylated as[feedback - prediction_before_performance] and SubjPE_3 is calcylated as[feedback - prediction_after_performance].


```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations_M <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_pred, Response_pred2, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_M$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between predictions before and after performance:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = Response_pred, y = Response_pred2, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Prediction before performance") + 
  ylab("Prediction after performance") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_M, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(0, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))
  
```


\newpage 
# Relationship between Anxiety and SubjPE_3

SubjPE_3 = feedback - prediction after performance

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations_Ax <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_Ax, SubjPE_3, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_Ax$correlation, na.rm = TRUE)
message_to_print_Ax <- paste("average correlation between anxiety and SubjPE_3:", average_correlation)

print(message_to_print_Ax)

ggplot(final_df19, aes(x = SubjPE_3, y = Response_Ax, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE_3: feedback - prediction_post_performance") + 
  ylab("Anxiety") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_Ax, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
ylim(c(0, 100)) +
scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
xlim(c(-100, 100)) +
scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
```

\newpage 
# Relationship between Mood and SubjPE


```{r echo=FALSE, warning=FALSE, message=FALSE}

correlations_M <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_H, Response_SubjPE, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_M$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and SubjPE:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = Response_SubjPE, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE: feedback - prediction") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_M, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
  
```

\newpage 
# Relationship between Mood and SubjPE_2

Again, here SubjPE_2 = prediction 2 - prediction 1 (question about how they think they performed - will perform).


```{r echo=FALSE, warning=FALSE, message=FALSE}

correlations_M <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_H, SubjPE_2, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_M$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and SubjPE_2:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = SubjPE_2, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE: feedback - prediction") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_M, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
  
```


\newpage 
# Relationship between Mood and SubjPE_3

SubjPE_3 = feedback - prediction 2 (question about how they think they performed).


```{r echo=FALSE, warning=FALSE, message=FALSE}

correlations_M <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_H, SubjPE_3, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_M$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and SubjPE_3:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = SubjPE_3, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE_3: feedback - prediction_post_performance") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_M, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
  
```



\newpage 
# Relationship between SubjPE and SubjPE_3


```{r echo=FALSE, warning=FALSE, message=FALSE}

correlations_M <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_SubjPE, SubjPE_3, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_M$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and SubjPE_3:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = SubjPE_3, y = Response_SubjPE, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("SubjPE_3: feedback - prediction_post_performance") + 
  ylab("SubjPE: feedback - prediction_pre_performance") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_M, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(-80, 80, by = 50), limits = c(-80,80))
  
```


\newpage 
# Relationship between Mood and feedback


```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations_Mfd <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_H, Response_fdbk, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations_Mfd$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and feedback:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = Response_fdbk, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Feedback") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations_Mfd, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```

\newpage 
# Relationship between Mood and prediction (pre-performance)

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_H, Response_pred, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and prediction before performance:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = Response_pred, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Prediction pre performance") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```

\newpage 
# Relationship between Mood and prediction (post-performance)

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_H, Response_pred2, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between mood and prediction after performance:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = Response_pred2, y = Response_H, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Prediction post performance") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```

\newpage 
# Relationship between Anxiety and prediction

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_Ax, Response_pred, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between anxiety and prediction:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = Response_pred, y = Response_Ax, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Prediction") + 
  ylab("Mood") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```

\newpage 
# Relationship between Anxiety and feedback

```{r echo=FALSE, warning=FALSE, message=FALSE}
correlations <- final_df19 %>%
  group_by(Random_ID) %>%
  summarise(correlation = cor(Response_Ax, Response_fdbk, use = "complete.obs")) %>%
  mutate(label = paste("R = ", round(correlation, digits = 2))) 

# calculate the average correlation across all individuals and print it 
average_correlation <- mean(correlations$correlation, na.rm = TRUE)
message_to_print_H <- paste("average correlation between anxiety and feedback:", average_correlation)

print(message_to_print_H)

ggplot(final_df19, aes(x = Response_fdbk, y = Response_Ax, color = Social_Anxiety, group= Social_Anxiety)) +
  geom_point(aes(color=Social_Anxiety, alpha = 0.3)) +
  geom_smooth(method = "lm", color="blue", aes(group=Random_ID)) + 
  # labs(color="Legend") +
  theme_minimal() +
  xlab("Feedback") + 
  ylab("Anxiety") +
    facet_wrap(~ Random_ID, scales = "free") +
    geom_text(data=correlations, aes(x=Inf, y=Inf, label=label, group=Random_ID), hjust=1.1, vjust=1.1, size=2.7, fontface = "bold", inherit.aes=FALSE) +
    theme(strip.text = element_text(size = 6),
        axis.text.x = element_text(size = 5.5),  
        axis.text.y = element_text(size = 5.5),  
        strip.text.x = element_text(face = "bold"),  
        strip.text.y = element_text(face = "bold"),  
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(c(0, 100)) + 
  scale_y_continuous(breaks = seq(0, 100, by = 25), limits = c(0, 100))+
  xlim(c(-100, 100)) + 
  scale_x_continuous(breaks = seq(0, 100, by = 25), limits = c(0,100))
  
```


```{r echo=FALSE, warning=FALSE, message=FALSE}
# trying to keep the BL_1 and BL_2 mood and anxiety ratings
df19_with_BL <- df19_raw[, c("Trial.Number", "Display", "Screen", "Response.Type", "Response", 
                     "Reaction.Time", "Spreadsheet..Histogram", "Spreadsheet..Feedback", "Random_ID")]

df19_with_BL <- df19_with_BL %>%
  mutate(Response = as.numeric(as.character(Response))) %>%
  dplyr::filter(!is.na(Response))

df19_with_BL$Screen <- ifelse(df19_with_BL$Trial.Number == 1 & (df19_with_BL$Display == "Mood " | df19_with_BL$Display == "Anxiety "), "BL_1",
                      ifelse(df19_with_BL$Trial.Number == 2 & (df19_with_BL$Display == "Mood " | df19_with_BL$Display == "Anxiety "), "BL_2", 
                             df19_with_BL$Screen))

df19_with_BL$m_hist <- ifelse(df19_with_BL$Spreadsheet..Histogram == "h1.png", 20,
                      ifelse(df19_with_BL$Spreadsheet..Histogram == "h2.png", 29,
                             ifelse(df19_with_BL$Spreadsheet..Histogram == "h3.png", 37,
                                    ifelse(df19_with_BL$Spreadsheet..Histogram == "h4.png", 46,
                                           ifelse(df19_with_BL$Spreadsheet..Histogram == "h5.png", 54,
                                                  ifelse(df19_with_BL$Spreadsheet..Histogram == "h6.png", 63,
                                                         ifelse(df19_with_BL$Spreadsheet..Histogram == "h7.png", 71,
                                                                ifelse(df19_with_BL$Spreadsheet..Histogram == "h8.png", 80, NA))))))))  


# get rid of the rows we don't need: practice runs, continue button presses etc. and only keep Trials, Anxiety and Mood that include all variables we are interested in:
df19_with_BL <- df19_with_BL %>%
  dplyr::filter(
    (Display == "Trials ") |
      (Display == "Anxiety ") |
      (Display == "Mood ")
  )

# # setting Mood and Anxiety trial numbers to match the trials starting from 1 (since we removed the baseline ones above)
df19_with_BL$Trial.Number <- ifelse(df19_with_BL$Display == 'Mood ' | df19_with_BL$Display == 'Anxiety ', df19_with_BL$Trial.Number - 2, df19_with_BL$Trial.Number)
# df19_with_BL$Display <- ifelse(df19_with_BL$Display == 'Mood ' | df19_with_BL$Display == 'Anxiety ', "Trials", df19_with_BL$Display)

final_df19_with_BL <- df19_with_BL[c("Trial.Number", "Display", "Screen", "Response", "Random_ID")]

final_df19_with_BL <- final_df19_with_BL %>%
  left_join(df19_spin %>% dplyr::select(Random_ID, mini_SPIN_total), by = "Random_ID")

final_df19_with_BL <- final_df19_with_BL %>%
  left_join(CESD_data_clean %>% dplyr::select(Random_ID, CESD_score, Depression_Threshold, Depression_status), by = "Random_ID")

final_df19_with_BL$Social_Anxiety <- ifelse(final_df19_with_BL$mini_SPIN_total >= 6, "high", "low")
```



\newpage 
# Mood over time 


```{r echo=FALSE, warning=FALSE, message=FALSE}
df19_BL_ax <- subset(final_df19_with_BL, Display == "Anxiety ")
df19_BL_H <- subset(final_df19_with_BL,Display == "Mood ")

ggplot(df19_BL_H, aes(x = Trial.Number, y = Response, color = Display, group = Display)) +
  geom_line(color = "blue") +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + # Adding a vertical line at Trial.Number == 1
  theme_minimal() +
  labs(title = "Mood across time",
       x = "Trial Number",
       y = "Mood",
       color = "") +
  facet_wrap(~ Random_ID, ncol = 6) + 
  theme(strip.text = element_text(size = 6)) +  
  scale_x_continuous(breaks = seq(-1, 48, by = 10), limits = c(-1, 48)) +
  scale_y_continuous(breaks = seq(0, 100, by = 20), limits = c(0, 100))+
  theme(axis.text.x = element_text(size = 5),axis.text.y = element_text(size = 5))

```

\newpage 
# Anxiety over time 
```{r echo=FALSE, warning=FALSE, message=FALSE}
ggplot(df19_BL_ax, aes(x = Trial.Number, y = Response, color = Display, group = Display)) +
  geom_line(color = "blue") +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + # Adding a vertical line at Trial.Number == 1
  theme_minimal() +
  labs(title = "Anxiety across time",
       x = "Trial Number",
       y = "Anxiety",
       color = "") +
  facet_wrap(~ Random_ID, ncol = 6) + 
  theme(strip.text = element_text(size = 6)) +  
  scale_x_continuous(breaks = seq(-1, 48, by = 10), limits = c(-1, 48)) +
  scale_y_continuous(breaks = seq(0, 100, by = 20), limits = c(0, 100))+
  theme(axis.text.x = element_text(size = 5),axis.text.y = element_text(size = 5))

```

\newpage 
# Prediction before judgement over time 

Red line presents until what points histograms were presented (4 first trials).

```{r echo=FALSE, warning=FALSE, message=FALSE}
ggplot(final_df19, aes(x = Trial.Number, y = Response_pred)) +
  geom_line(color = "blue") +
  geom_vline(xintercept = 5, linetype = "dashed", color = "red") + 
  theme_minimal() +
  labs(title = "Prediction before performance across time",
       x = "Trial Number",
       y = "Pre-prediction",
       color = "") +
  facet_wrap(~ Random_ID, ncol = 6) + 
  theme(strip.text = element_text(size = 6)) +  
  scale_x_continuous(breaks = seq(1, 48, by = 10), limits = c(1, 48)) +
  scale_y_continuous(breaks = seq(0, 100, by = 20), limits = c(0, 100))+
  theme(axis.text.x = element_text(size = 5),axis.text.y = element_text(size = 5))

```


\newpage 
# Stress level based on believability and social anxiety


```{r echo=FALSE, warning=FALSE, message=FALSE}
filter_df <- subset(final_df19, final_df19$Trial.Number == 1)

ggplot(filter_df, aes(x = Social_Anxiety, y = Response_stress_level , fill = Social_Anxiety)) +
  geom_boxplot(outlier.colour = "black") +
  stat_boxplot(geom = "errorbar",
               width = 0.15) + 
  geom_point(color = "black", position = position_jitter(width = 0.2), alpha = 0.7) +
  theme_minimal() +
  # labs(x = "Display", y = "Response") +
  # scale_y_continuous(breaks = seq(0, 100, by = 10), limits = c(0, 100)) +
  # ggtitle("Average anxiety ratings in pilots 1 and 2 in socially anxious people") +
  xlab("") + 
  ylab("stress levels (0-10)") +
  theme(
    panel.grid.major = element_blank(),  # Removes major grid lines
    panel.grid.minor = element_blank(),  # Removes minor grid lines
    panel.border = element_blank(),      # Removes the border line
    axis.line = element_blank(),          # Removes axis lines
    plot.background = element_rect(fill = "white", colour = NA)   # Ensure plot background is white
  )

ggplot(filter_df, aes(x = believability, y = Response_stress_level , fill = believability)) +
  geom_boxplot(outlier.colour = "black") +
  stat_boxplot(geom = "errorbar",
               width = 0.15) + 
  geom_point(color = "black", position = position_jitter(width = 0.2), alpha = 0.7) +
  theme_minimal() +
  # labs(x = "Display", y = "Response") +
  # scale_y_continuous(breaks = seq(0, 100, by = 10), limits = c(0, 100)) +
  # ggtitle("Average anxiety ratings in pilots 1 and 2 in socially anxious people") +
  xlab("") + 
  ylab("stress levels (0-10)") +
  theme(
    panel.grid.major = element_blank(),  # Removes major grid lines
    panel.grid.minor = element_blank(),  # Removes minor grid lines
    panel.border = element_blank(),      # Removes the border line
    axis.line = element_blank(),          # Removes axis lines
    plot.background = element_rect(fill = "white", colour = NA)   # Ensure plot background is white
  )

```


\newpage 
# ICC for Mood with chocking
```{r echo=FALSE, warning=FALSE, message=FALSE}
test_icc_id <- lmer(Response_H ~  (1| Random_ID), data = 
                      final_df19, 
                    REML = FALSE, 
                    control = lmerControl(optimizer = "bobyqa")) 
icc_results_id <- performance::icc(test_icc_id)

icc_results_id
```

\newpage 
# ICC for Anxiety with chocking
```{r echo=FALSE, warning=FALSE, message=FALSE}
test_icc_id <- lmer(Response_Ax ~  (1| Random_ID), data = 
                      final_df19, 
                    REML = FALSE, 
                    control = lmerControl(optimizer = "bobyqa")) 
icc_results_id <- performance::icc(test_icc_id)

icc_results_id
```

# LME models for Mood and SubjPE

The best model seems to be: Mood ~ SubjPE + mini_SPIN_total + (SubjPE | Random_ID)

```{r echo=FALSE, warning=FALSE, message=FALSE}
model1 <- lme4::lmer(Response_H ~ Response_SubjPE +  (Response_SubjPE | Random_ID), data = final_df19, control=lmerControl(optimizer="bobyqa"))
model2 <- lme4::lmer(Response_H ~ Response_SubjPE +  mini_SPIN_total + (1 | Random_ID), data = final_df19, control=lmerControl(optimizer="bobyqa"))
model3 <- lme4::lmer(Response_H ~ Response_SubjPE + mini_SPIN_total + (Response_SubjPE | Random_ID), data = final_df19, control=lmerControl(optimizer="bobyqa"))

AIC(model1)
AIC(model2)
AIC(model3)

coef_fixed <- fixef(model3)
intercept_Response_H <- coef_fixed[1]
slope_Response_H <- coef_fixed[2]
standard_beta_Response_SubjPE <- parameters:: standardise_parameters (model3)

# Hypothetical standard errors for intercept and slope
SE_intercept <- 0.15  # Placeholder value
SE_slope <- 0.43      # Placeholder value
CI_multiplier <- 1.96  # 95% CI multiplier for a normal distribution

# Creating a sequence of `SubjPE` values for prediction
Response_SubjPE_range <- seq(min(final_df19$Response_SubjPE), max(final_df19$Response_SubjPE), length.out = 100)

# Calculating predicted Response_H and its CI bounds across the SubjPE range
predicted_Response_H <- intercept_Response_H + slope_Response_H * Response_SubjPE_range
CI_lower <- predicted_Response_H - CI_multiplier * sqrt(SE_intercept^2 + (Response_SubjPE_range^2 * SE_slope^2))
CI_upper <- predicted_Response_H + CI_multiplier * sqrt(SE_intercept^2 + (Response_SubjPE_range^2 * SE_slope^2))

# Preparing a data frame for ggplot
CI_data <- data.frame(Response_SubjPE=Response_SubjPE_range, CI_lower=CI_lower, CI_upper=CI_upper)


ggplot(final_df19, aes(x=Response_SubjPE, y=Response_H)) +
  # Adding points from your dataset
  # geom_point() +
  # Adding a regression line
  geom_abline(intercept=intercept_Response_H, slope=slope_Response_H, color="darkgoldenrod1", linetype="dashed", size=1) +
  # Adding the confidence interval with geom_ribbon
  geom_ribbon(data=CI_data, aes(x=Response_SubjPE, ymin=CI_lower, ymax=CI_upper), fill="gray80", alpha=0.5, inherit.aes = FALSE) +
  # Further customization
  xlab("Social PE") + 
  ylab("Mood") +
  ggtitle("", subtitle=paste("Estimated slopes of the association in n = ", length(unique(final_df19$Random_ID)))) +
  theme(plot.title=element_text(size=12), plot.subtitle=element_text(size=10),
        legend.title=element_text(size=12), legend.text=element_text(size=12),
        axis.title=element_text(size=13),
        axis.text=element_text(size=12),
        panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(),
        panel.border=element_rect(colour="black", fill=NA)) +
  annotate("label", x=12, y=55, label=paste("beta =", round(standard_beta_Response_SubjPE$Std_Coefficient[2],2), ", 95%CI =", 
                                            round(standard_beta_Response_SubjPE$CI_low[2],2), "-", round(standard_beta_Response_SubjPE$CI_high[2],2))) +
  scale_y_continuous(breaks=seq(0, 100, by=20), limits=c(0, 100)) +
  scale_x_continuous(breaks=seq(-80, 80, by=40), limits=c(-80, 80))

```
# LME models for Anxiety and SubjPE

The best model seems to be: Mood ~ SubjPE + mini_SPIN_total + (SubjPE | Random_ID)

```{r echo=FALSE, warning=FALSE, message=FALSE}
model1 <- lme4::lmer(Response_H ~ Response_SubjPE +  (Response_SubjPE | Random_ID), data = final_df19, control=lmerControl(optimizer="bobyqa"))
model2 <- lme4::lmer(Response_H ~ Response_SubjPE +  mini_SPIN_total + (1 | Random_ID), data = final_df19, control=lmerControl(optimizer="bobyqa"))
model3 <- lme4::lmer(Response_H ~ Response_SubjPE + mini_SPIN_total + (Response_SubjPE | Random_ID), data = final_df19, control=lmerControl(optimizer="bobyqa"))

AIC(model1)
AIC(model2)
AIC(model3)

coef_fixed <- fixef(model3)
intercept_Response_H <- coef_fixed[1]
slope_Response_H <- coef_fixed[2]
standard_beta_Response_SubjPE <- parameters:: standardise_parameters (model3)

# Hypothetical standard errors for intercept and slope
SE_intercept <- 0.15  # Placeholder value
SE_slope <- 0.43      # Placeholder value
CI_multiplier <- 1.96  # 95% CI multiplier for a normal distribution

# Creating a sequence of `SubjPE` values for prediction
Response_SubjPE_range <- seq(min(final_df19$Response_SubjPE), max(final_df19$Response_SubjPE), length.out = 100)

# Calculating predicted Response_H and its CI bounds across the SubjPE range
predicted_Response_H <- intercept_Response_H + slope_Response_H * Response_SubjPE_range
CI_lower <- predicted_Response_H - CI_multiplier * sqrt(SE_intercept^2 + (Response_SubjPE_range^2 * SE_slope^2))
CI_upper <- predicted_Response_H + CI_multiplier * sqrt(SE_intercept^2 + (Response_SubjPE_range^2 * SE_slope^2))

# Preparing a data frame for ggplot
CI_data <- data.frame(Response_SubjPE=Response_SubjPE_range, CI_lower=CI_lower, CI_upper=CI_upper)


ggplot(final_df19, aes(x=Response_SubjPE, y=Response_H)) +
  # Adding points from your dataset
  # geom_point() +
  # Adding a regression line
  geom_abline(intercept=intercept_Response_H, slope=slope_Response_H, color="darkgoldenrod1", linetype="dashed", size=1) +
  # Adding the confidence interval with geom_ribbon
  geom_ribbon(data=CI_data, aes(x=Response_SubjPE, ymin=CI_lower, ymax=CI_upper), fill="gray80", alpha=0.5, inherit.aes = FALSE) +
  # Further customization
  xlab("Social PE") + 
  ylab("Mood") +
  ggtitle("", subtitle=paste("Estimated slopes of the association in n = ", length(unique(final_df19$Random_ID)))) +
  theme(plot.title=element_text(size=12), plot.subtitle=element_text(size=10),
        legend.title=element_text(size=12), legend.text=element_text(size=12),
        axis.title=element_text(size=13),
        axis.text=element_text(size=12),
        panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(),
        panel.border=element_rect(colour="black", fill=NA)) +
  annotate("label", x=12, y=55, label=paste("beta =", round(standard_beta_Response_SubjPE$Std_Coefficient[2],2), ", 95%CI =", 
                                            round(standard_beta_Response_SubjPE$CI_low[2],2), "-", round(standard_beta_Response_SubjPE$CI_high[2],2))) +
  scale_y_continuous(breaks=seq(0, 100, by=20), limits=c(0, 100)) +
  scale_x_continuous(breaks=seq(-80, 80, by=40), limits=c(-80, 80))

```